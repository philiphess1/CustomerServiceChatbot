{% extends "base.html" %}

{% block styles %}
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <title>Settings</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/settings.css') }}">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link rel="shortcut icon" href="{{ url_for('static', filename='images/favicon.ico') }}">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
{% endblock %}

{% block content %}
<div class="container p-0 main-content">
    <h1 class="h3 mb-3"></h1>
    <div class="row">
        <div class="col-md-4 col-xl-3">

            <div class="card sidebar-card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Account Settings</h5>
                </div>
                <form id="settingsForm" action="{{ url_for('update_chatbot_settings', chatbot_id=chatbot_id) }}" method="post" enctype="multipart/form-data">
                <div class="list-group list-group-flush" role="tablist">
                    <a class="list-group-item list-group-item-action active" data-toggle="list" href="#" role="tab" data-target="styling-section">
                        Styling
                    </a>
                    <a class="list-group-item list-group-item-action" data-toggle="list" href="#" role="tab" data-target="branding-section">
                        Branding
                    </a>
                    <a class="list-group-item list-group-item-action" data-toggle="list" href="#" role="tab" data-target="system-settings">
                        System Settings
                    </a>
                    <a class="list-group-item list-group-item-action" data-toggle="list" href="#" role="tab" data-target="faq-settings">
                        FAQs
                    </a>
                    <a class="list-group-item list-group-item-action" data-toggle="list" href="#" role="tab" data-target="user-form">
                        User Form
                    </a>
                </div>
            </div>
        </div>
        <div class="col-md-8 col-xl-9">
            <div class="tab-content">
                <div class="tab-pane fade show active" id="styling-section" role="tabpanel">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-actions float-right">
                                <div class="dropdown show">
                                    <a href="#" data-toggle="dropdown" data-display="static">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-horizontal align-middle">
                                            <circle cx="12" cy="12" r="1"></circle>
                                            <circle cx="19" cy="12" r="1"></circle>
                                            <circle cx="5" cy="12" r="1"></circle>
                                        </svg>
                                    </a>
                                    <div class="dropdown-menu dropdown-menu-right">
                                        <a class="dropdown-item" href="#">Action</a>
                                        <a class="dropdown-item" href="#">Another action</a>
                                        <a class="dropdown-item" href="#">Something else here</a>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- STYLING SETTINGS --><!-- STYLING SETTINGS --><!-- STYLING SETTINGS --><!-- STYLING SETTINGS -->
                            <!-- STYLING SETTINGS --><!-- STYLING SETTINGS --><!-- STYLING SETTINGS --><!-- STYLING SETTINGS -->
                            
                            <h5 class="card-title mb-0">Styling Settings</h5>
                        </div>
                        <div class="card-body">
                            <div class="settings-container">
                                <div class="settings-section condensed">
                                    <div class="settings-group">
                                        <label for="heading_font_color">Heading Font Color</label>
                                        <input type="color" id="heading_font_color" name="heading_font_color" class="mt-space" value="{{ settings['heading_font_color'] }}">
                                    </div>
                                    <div class="settings-group">
                                        <label for="border_color">Heading Background Color</label>
                                        <input type="color" id="border_color" name="border_color" value="{{ settings['border_color'] }}">
                                    </div>
                                    <div class="settings-group">
                                        <label for="background_color">Chatbot Background Color</label>
                                        <input type="color" id="background_color" name="background_color" value="{{ settings['background_color'] }}">
                                    </div>
                                    <div class="settings-group">
                                        <label for="dot_color">Dot Animation Color</label>
                                        <input type="color" id="dot_color" name="dot_color" value="{{ settings['dot_color'] }}">
                                    </div>
                                    <div class="settings-group">
                                        <label for="bot_bubble_color">Bot Text Bubble Color</label>
                                        <input type="color" id="bot_bubble_color" name="bot_bubble_color" value="{{ settings['bot_bubble_color'] }}">                                        
                                    </div>
                                    <div class="settings-group">
                                        <label for="user_bubble_color">User Text Bubble Color</label>
                                        <input type="color" id="user_bubble_color" name="user_bubble_color" value="{{ settings['user_bubble_color'] }}">                                    
                                    </div>
                                </div>
                                <div class="settings-section condensed">
                                    <div class="settings-group">
                                        <label for="chatbot_title">Chatbot Title:</label>
                                        <input type="text" id="chatbot_title" name="chatbot_title" value="{{ settings['chatbot_title'] }}" maxlength="20">
                                        <div><em><small>Must be no more than 20 characters.</small></em></div>
                                    </div>
                                    <div class="settings-group">
                                        <label for="popup_message">Pop Up Message:</label>
                                        <input type="text" id="popup_message" name="popup_message" value="{{ settings['popup_message'] }}" style="min-width: 300px;" maxlength="50">
                                        <div><em><small>Must be no more than 50 characters.</small></em></div>
                                    </div>
                                    <div class="settings-group">
                                        <label for="include_email_form">Include Email Form:</label>
                                        <input type="checkbox" id="include_email_form" name="include_email_form" {% if settings['include_email_form'] %}checked{% endif %}>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                        
                        <!-- BRANDING SETTINGS --><!-- BRANDING SETTINGS --><!-- BRANDING SETTINGS --><!-- BRANDING SETTINGS -->
                        <!-- BRANDING SETTINGS --><!-- BRANDING SETTINGS --><!-- BRANDING SETTINGS --><!-- BRANDING SETTINGS -->

                <div class="tab-pane fade" id="branding-section" role="tabpanel">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Branding Settings</h5>
                            <div class="settings-section">

                                <label for="logo">Chatbot Name:</label><br>
                                <input type="text" id="chatbot_name" name="chatbot_name" value="{{ settings['chatbot_name'] }}" maxlength="20"><br>
                                <em><small>Must be no more than 20 characters.</small></em><br><br>
                                <label for="logo">Logo:</label><br>
                                <img id="currentLogo" src="{{ settings['logo'] }}" alt="Current Logo" style="width: 100px; height: 100px;">
                                <br>
                                <input type="file" id="logo" name="logo" accept="image/png" {% if user_plan == 'price_1P9FIULO2ToUaMQEmx2wG1qC' %}disabled{% endif %}><br>
                                <br>
                                <label for="font_style">Font Style:</label>
                                <br>
                                <select id="font_style" name="font_style">
                                    {% set font_options = ['Arial', 'Verdana', 'Times New Roman', 'Courier New', 'Georgia', 'Impact', 'Lucida Console', 'Tahoma', 'Trebuchet MS', 'Comic Sans MS', 'Palatino Linotype', 'Arial Black', 'Book Antiqua', 'Garamond', 'Courier', 'Franklin Gothic Medium', 'Copperplate', 'Century Gothic', 'Rockwell', 'Baskerville', 'Californian FB', 'Candara', 'Consolas', 'Ebrima', 'Cambria', 'MS Gothic', 'MS Mincho'] %}
                                    {% for font in font_options %}
                                        <option value="{{ font }}" style="font-family: '{{ font }}';" {% if settings['font_style'] == font %}selected{% endif %}>{{ font }}</option>
                                    {% endfor %}
                                </select><br><br>
                                <label>Widget Icon:</label><br>
                                <img id="selected-icon" src="{{ url_for('static', filename='images/' + settings['widget_icon']) }}" alt="Selected Icon" height="100px" width="100px">
                                <br>
                                <select id="icon-select" name="icon-select" style="width: 200px;">
                                    <option value="{{settings['widget_icon']}}" selected data-icon="{{ url_for('static', filename='images/' + settings['widget_icon']) }}">Current</option>
                                    <option value="ecco_icon.svg" data-icon="{{ url_for('static', filename='images/ecco_icon.svg') }}" {% if settings['widget_icon'] == url_for('static', filename='images/ecco_icon.svg') %}selected{% endif %}>Lime</option>
                                    <option value="ecco_icon_black.svg" data-icon="{{ url_for('static', filename='images/ecco_icon_black.svg') }}" {% if settings['widget_icon'] == url_for('static', filename='images/ecco_icon_black.svg') %}selected{% endif %}>Black</option>
                                    <option value="ecco_icon_blue.svg" data-icon="{{ url_for('static', filename='images/ecco_icon_blue.svg') }}" {% if settings['widget_icon'] == url_for('static', filename='images/ecco_icon_blue.svg') %}selected{% endif %}>Blue</option>
                                    <option value="ecco_icon_grey.svg" data-icon="{{ url_for('static', filename='images/ecco_icon_grey.svg') }}" {% if settings['widget_icon'] == url_for('static', filename='images/ecco_icon_grey.svg') %}selected{% endif %}>Grey</option>
                                    <option value="ecco_icon_orange.svg" data-icon="{{ url_for('static', filename='images/ecco_icon_orange.svg') }}" {% if settings['widget_icon'] == url_for('static', filename='images/ecco_icon_orange.svg') %}selected{% endif %}>Orange</option>
                                    <option value="ecco_icon_purple.svg" data-icon="{{ url_for('static', filename='images/ecco_icon_purple.svg') }}" {% if settings['widget_icon'] == url_for('static', filename='images/ecco_icon_purple.svg') %}selected{% endif %}>Purple</option>
                                    <option value="ecco_icon_red.svg" data-icon="{{ url_for('static', filename='images/ecco_icon_red.svg') }}" {% if settings['widget_icon'] == url_for('static', filename='images/ecco_icon_red.svg') %}selected{% endif %}>Red</option>
                                    <option value="ecco_icon_yellow.svg" data-icon="{{ url_for('static', filename='images/ecco_icon_yellow.svg') }}" {% if settings['widget_icon'] == url_for('static', filename='images/ecco_icon_yellow.svg') %}selected{% endif %}>Yellow</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="system-settings" role="tabpanel">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-actions float-right">
                                <div class="dropdown show">
                                    <a href="#" data-toggle="dropdown" data-display="static">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-horizontal align-middle">
                                            <circle cx="12" cy="12" r="1"></circle>
                                            <circle cx="19" cy="12" r="1"></circle>
                                            <circle cx="5" cy="12" r="1"></circle>
                                        </svg>
                                    </a>
                                    <div class="dropdown-menu dropdown-menu-right">
                                        <a class="dropdown-item" href="#">Action</a>
                                        <a class="dropdown-item" href="#">Another action</a>
                                        <a class="dropdown-item" href="#">Something else here</a>
                                    </div>
                                </div>
                            </div>

                            <!-- SYSTEM SETTINGS --><!-- SYSTEM SETTINGS --><!-- SYSTEM SETTINGS --><!-- SYSTEM SETTINGS -->
                            <!-- SYSTEM SETTINGS --><!-- SYSTEM SETTINGS --><!-- SYSTEM SETTINGS --><!-- SYSTEM SETTINGS -->
                            <h5 class="card-title mb-0">System Settings</h5>
                        </div>
                        <div class="card-body">
                            <div class="settings-container">
                                <div class="settings-section">
                                    <label for="bot_temperature">Bot Temperature:</label>
                                    <div><span id="bot_temperature_value">{{ settings['bot_temperature'] }}</span></div>
                                    <div class="range-container">
                                        <span>More Accurate</span>
                                        <input type="range" id="bot_temperature" name="bot_temperature" min="0" max="1" step="0.1" value="{{ settings['bot_temperature'] }}">
                                        <span>More Creative</span>
                                    </div><br>
                                    <label for="bot_LLM">Assistant LLM:</label>
                                    <select id="bot_LLM" name="bot_LLM" {% if user_plan == 'price_1P9FIULO2ToUaMQEmx2wG1qC' %}disabled{% endif %}>
                                        <option value="gpt-3.5-turbo" {% if settings['LLM'] == 'gpt-3.5-turbo' %}selected{% endif %}>GPT 3.5 Turbo</option>
                                        <option value="gpt-4-turbo" {% if settings['LLM'] == 'gpt-4-turbo' %}selected{% endif %}>GPT 4.0o</option>
                                    </select><br><br>
                                    <label for="greeting_message">Greeting Message:</label>
                                    <textarea id="greeting_message" name="greeting_message" rows="4" cols="50" maxlength="500">{{ settings['greeting_message'] }}</textarea>
                                    <em><small>Must be no more than 250 characters.</small></em><br><br>
                                    <label for="custom_prompt">Custom Prompt:</label>
                                    <textarea id="custom_prompt" name="custom_prompt" rows="4" cols="50" maxlength="1000" style="resize: both;">{{ settings['custom_prompt'] }}</textarea>
                                    <br>
                                    <em><small>Must be no more than 1000 characters.</small></em><br><br>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="faq-settings" role="tabpanel">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-actions float-right">
                                <div class="dropdown show">
                                    <a href="#" data-toggle="dropdown" data-display="static">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-horizontal align-middle">
                                            <circle cx="12" cy="12" r="1"></circle>
                                            <circle cx="19" cy="12" r="1"></circle>
                                            <circle cx="5" cy="12" r="1"></circle>
                                        </svg>
                                    </a>
                                    <div class="dropdown-menu dropdown-menu-right">
                                        <a class="dropdown-item" href="#">Action</a>
                                        <a class="dropdown-item" href="#">Another action</a>
                                        <a class="dropdown-item" href="#">Something else here</a>
                                    </div>
                                </div>
                            </div>
                            <!-- FAQ SETTINGS --><!-- FAQ SETTINGS --><!-- FAQ SETTINGS --><!-- FAQ SETTINGS -->
                            <!-- FAQ SETTINGS --><!-- FAQ SETTINGS --><!-- FAQ SETTINGS --><!-- FAQ SETTINGS -->
                            <h5 class="card-title mb-0">FAQ Settings</h5>
                        </div>
                        <div class="card-body">
                            <div class="settings-container">
                                <div class="settings-section1">
                                    <h3>Pre-made Questions</h3>
                                    <div id="premade-questions-container">
                                        {% for id, question, response in premade_questions %}
                                        <div class="premade-question" data-saved="true" id="question_{{ id }}">
                                            <input type="hidden" name="premade_question_ids[]" value="{{ id }}">
                                            <label for="premade_question_{{ loop.index }}">Question:</label>
                                            <textarea id="premade_question_{{ loop.index }}" name="premade_questions[]" required readonly>{{ question }}</textarea>
                                            <label for="premade_response_{{ loop.index }}">Response:</label>
                                            <textarea id="premade_response_{{ loop.index }}" name="premade_responses[]" required readonly>{{ response }}</textarea>
                                            <button type="button" class="delete-premade-question">Delete</button>
                                        </div>
                                        {% endfor %}
                                    </div>
                                    <br>
                                    <button type="button" id="add-premade-question">Add Question</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="user-form" role="tabpanel">
                    <!-- Content for User Form -->
                </div>
            </div>
        </div>
            <input type="submit" value="Save Settings" class="save-settings-button">  
    </div>
</form>
</div>
{% endblock %}

{% block scripts %}
<script type="text/javascript" src="http://127.0.0.1:5000/{{ user_id }}/{{ chatbot_id }}/popup.js"></script>
<script src="{{ url_for('static', filename='js/settings.js') }}"></script>
<script>
    document.addEventListener('DOMContentLoaded', (event) => {
        const tabLinks = document.querySelectorAll('.list-group-item');
        const tabContent = document.querySelectorAll('.tab-pane');

        tabLinks.forEach(link => {
            link.addEventListener('click', function(event) {
                event.preventDefault();
                const target = this.getAttribute('data-target');

                tabLinks.forEach(link => link.classList.remove('active'));
                tabContent.forEach(content => content.classList.remove('show', 'active'));

                this.classList.add('active');
                document.getElementById(target).classList.add('show', 'active');
            });
        });
    });
</script>
{% endblock %}
